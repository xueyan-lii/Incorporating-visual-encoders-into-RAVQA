from transformers import LlamaForCausalLM, LlamaTokenizer
import re
#tokenizer = LlamaTokenizer.from_pretrained("/home/xl544/rds/rds-cvnlp-hirYTW1FQIw/shared_space/converted_llama2_weights/llama-2-7b-chat")
#model = LlamaForCausalLM.from_pretrained("/home/xl544/rds/rds-cvnlp-hirYTW1FQIw/shared_space/converted_llama2_weights/llama-2-7b-chat")
tokenizer = LlamaTokenizer.from_pretrained("/home/xl544/rds/rds-cvnlp-hirYTW1FQIw/shared_space/converted_vicuna_weights/vicuna-13b")
model = LlamaForCausalLM.from_pretrained("/home/xl544/rds/rds-cvnlp-hirYTW1FQIw/shared_space/converted_vicuna_weights/vicuna-13b")

prompts = ["Answer the question according to the context and answer candidates. Each answer candidate is associated with a confidence score within a bracket. The true answer may not be included in the candidates.  Context: a woman riding a wave on a surfboard in the ocean. Question: What does this woman need to wear to do this? Candidates: swimsuit (0.932), bath suit (0.921), wetsuit (0.902),  Answer: bath suit Context: a catcher in a baseball game throwing a ball. Question: What is this person about to do with the ball? Candidates: pitch (0.868), throw (0.861), throw it (0.835),  Answer: throw it Context: a young boy wearing a tie sitting in a wooden chair. Question: What is the cultural background of people with red hair? Candidates: irish (0.848), blond (0.799), white (0.788),  Answer: irish Context: a train yard with trains and buildings in the background. Question: What is the name of the person that designed these? Candidates: george stephenson (0.823), engineer (0.813), graff (0.811), samuel fox (0.8), thomas edison (0.795), richard trevithick (0.788), thomas elmo (0.787), frederick graff (0.782), thomas elmslie (0.78), eno (0.771), thomas jones (0.766), thomas joyce (0.763), garrett morgan (0.763),  Answer: george stephenson Context: a baseball player holding a bat on a field. Question: What was the man trying to do with the stick? Candidates: hit (0.824), bat (0.784),  Answer: hit ball Context: a red double decker bus driving down a street. Question: What would one use to get to the second level? Candidates: stair (0.85), staircase (0.815), lift (0.795), ride (0.778), tour (0.775), elevator (0.772),  Answer: stair Context: a clock on the side of a building. Question: What can you tell by looking at the square object? Candidates: time (0.839),  Answer: time Context: a large brown bear walking through a forest. Question: What likes honey and lives in the woods? Candidates: bear (0.849), hunt (0.754),  Answer: bear Context: a dirty bathroom with a toilet and a sink. Question: What can you do to protect yourself from this environment? Candidates: leave (0.844),  Answer: leave Context: two women playing a video game in front of a television. Question: What is the name of this game they are playing? Candidates: wii (0.817),  Answer: wii box Context: a couple of men in suits looking at a tablet. Question: What device are the two men in the photo using? Candidates: tablet (0.886),  Answer: tablet Context: a person holding a hot dog with ketchup and mustard. Question: What is the name of this style of hot dog? Candidates: chicago (0.873), swiss (0.855), st louis (0.853), kansas city (0.841), philly (0.833), frankfurter (0.824), ball park (0.823), kentucky (0.82),  Answer: chicago Context: a woman standing on the sidewalk with her luggage. Question: What might this woman's trousers be made of? Candidates: denim (0.881), cotton (0.837),  Answer: denim Context: an old rusted out train sitting on the tracks. Question: What is the cause of the color of the vehicle? Candidates: rust (0.892),  Answer: rust Context: a group of people hiking up a snow covered mountain. Question: What are the things called that are in their hands? Candidates: pole (0.878), stick (0.787),  Answer: pole Context: a young girl cutting a man's hair with a pair of scissors. Question: What is the name of the style of beard? Candidates: goatee (0.897), short (0.87),  Answer: goatee Context: a large boat in the water near a city. Question: What is the name for this type of waterway? Candidates: canal (0.809), river (0.793), ferry (0.78),  Answer: canal Context: a young girl riding on the back of a brown horse. Question: What type of shoe is person in this picture wearing? Candidates: boot (0.857),  Answer: boot Context: a white bus driving down a city street. Question: What is the state of the business on the left? Candidates: philippines (0.741), open (0.726), new york time (0.696), phoenix (0.688),  Answer: open Context: a dog laying on the floor with a water bottle. Question: What was the type of plastic in the dogs mouth? Candidates: bottle (0.819), water (0.773), plastic (0.764),  Answer: bottle Context: a man in a tuxedo walking down a city street. Question: What could this gentleman be carrying in that red bag? Candidates: book (0.853), bag (0.841), newspaper (0.817), luggage (0.814), suitcase (0.807), carry thing (0.807), carry on (0.804),  Answer: ",
"Answer the question according to the context and answer candidates. Each answer candidate is associated with a confidence score within a bracket. The true answer may not be included in the candidates.  Context: a group of people walking down a sidewalk with surfboards. Question: What is the length of the surfboard the man in the black shorts at the back of the line of people is holding? Candidates: 7 feet (0.818), 6 (0.805), 6 feet (0.798), 8 feet (0.797), longboard (0.789), 9 feet (0.776),  Answer: 7 feet Context: a dog jumping in the air to catch a frisbee. Question: Which part of this animal moves to and fro when the animal is excited? Candidates: tail (0.835),  Answer: tail Context: an elephant standing next to a tree in a field. Question: What part of this animal is sold illegally? Candidates: tusk (0.871),  Answer: tusk Context: a close up of a sandwich with carrots and peppers. Question: Which part of the body is the orange vegetable said to be good for? Candidates: eye (0.822), skin (0.798),  Answer: eye Context: a person standing in the snow holding a snowboard. Question: Which part of the body should this equipment be worn on? Candidates: feet (0.854),  Answer: feet Context: a white plate of food with rice and broccoli. Question: Which part of this meal has the most carbohydrates? Candidates: rice (0.846),  Answer: rice Context: a man and a woman standing at a kitchen counter. Question: What part of the house are they in? Candidates: kitchen (0.844),  Answer: kitchen Context: a group of horses standing in front of a fountain. Question: What part of the city would this be located in? Candidates: park (0.807), downtown (0.792), central (0.777), city (0.774), square (0.772), plaza (0.768),  Answer: park Context: two cats sitting on top of a toilet in a bathroom. Question: How many of this animal are in the us? Candidates: 8 million (0.882), 85.8 million (0.878), million (0.874), 2 (0.861), 163 million (0.847), 95% (0.844), 7 million (0.841), 20 million (0.835), 5 million (0.835), 20 (0.824), 600 million (0.82), 75 million (0.82), 9 (0.819), 84.9 million (0.817), 457 (0.816), 7 (0.81), 85 million (0.81), 358 million (0.797),  Answer: 85.8 million Context: a couple of giraffes are standing in a field. Question: The baby of this animal is called what? Candidates: foal (0.868), calf (0.845), giraffe (0.82),  Answer: calf Context: an open refrigerator with food in a kitchen. Question: What part of the house would this be located in? Candidates: kitchen (0.884),  Answer: kitchen Context: a view of an airplane wing from an airplane window. Question: What part of this object will be raised during descent? Candidates: flap (0.887),  Answer: flap Context: a group of zebras standing next to each other. Question: This portion of an animal is known as its what? Candidates: hindquarter (0.859),  Answer: hindquarter Context: a couple of children's toys sitting on the grass. Question: What part of the neighborhood would you find this? Candidates: park (0.824), playground (0.79),  Answer: playground Context: a man holding a tennis racket in his hand. Question: What sort of joint distress affecting the middle of the arm borrows its name from the game played with this racket? Candidates: tennis elbow (0.829), tennis (0.76), sprain (0.744),  Answer: tennis elbow Context: a cat laying on top of a bed. Question: How long does this animal usually live? Candidates: 8 years (0.925), 7 years (0.875), 15 years (0.871), 16 years (0.868), 12 years (0.86), 10 years (0.855), 9 years (0.842),  Answer: 9 years Context: a black and white photo of a cow standing on a road. Question: How long does this animal usually live? Candidates: 20 years (0.893), 10 years (0.859), 15 years (0.85), 25 years (0.846),  Answer: 30 years Context: a group of cows drinking water from a river. Question: What sound does this animal make? Candidates: moo (0.89), neigh (0.864), eat (0.824),  Answer: neigh Context: a cat laying on a couch next to a person with a laptop. Question: What sound does this animal make? Candidates: meow (0.898),  Answer: meow Context: a woman walking a white dog on a leash. Question: What sound does this animal make? Candidates: bark (0.881), woof (0.876), baa (0.842),  Answer: woof Context: a man holding two frisbees with a dog on his back. Question: Which part of this animal would be in use of it was playing the game that is played with the items the man is holding? Candidates: tail (0.783), mouth (0.755), arm (0.744),  Answer: ",
"Answer the question according to the context and answer candidates. Each answer candidate is associated with a confidence score within a bracket. The true answer may not be included in the candidates.  Context: a person holding a donut with almonds on it. Question: What do i do with this? Candidates: eat (0.846),  Answer: eat Context: a dog sleeping on a bed on a couch. Question: When would a person do this? Candidates: night (0.815), bed (0.799),  Answer: night Context: a computer keyboard and a mouse on a desk. Question: What can i use these for? Candidates: computer (0.87), type (0.862),  Answer: computer Context: a vase of flowers sitting next to a bunk bed. Question: What room of the house is this? Candidates: bedroom (0.811),  Answer: bedroom Context: a white plate of food with potatoes and meat. Question: When would i eat this? Candidates: breakfast (0.879), lunch (0.855), morn (0.839), dinner (0.83),  Answer: breakfast Context: a plate of food with meat and broccoli on a table. Question: When would i eat this? Candidates: dinner (0.883),  Answer: dinner Context: a bathroom with a toilet and a trash can. Question: How to keep the toilet bowl clean? Candidates: bleach (0.857), brush (0.821), flush (0.796),  Answer: bleach Context: a couple of street signs on a pole in a city. Question: What part of the street is this? Candidates: intersection (0.822), street (0.786),  Answer: intersection Context: a man holding a hot dog in a room. Question: Why would he be holding that? Candidates: hungry (0.799), eat (0.768),  Answer: eat Context: a group of boats sitting on the shore of a beach at sunset. Question: What time of the day is it? Candidates: even (0.811), night (0.802), dusk (0.8), sunset (0.8),  Answer: even Context: a sandwich on a white plate with a knife. Question: Who wouldn't eat this? Candidates: vegetarian (0.845), kid (0.813), vegan (0.811),  Answer: vegetarian Context: a group of penguins playing in a pool of water. Question: What zoo is this? Candidates: san diego (0.787), cincinnati (0.773), penguin (0.756), miami (0.746), madagascar (0.741), zoo (0.739), chicago (0.739), bronx (0.737), new york (0.73),  Answer: san diego Context: a couple of books are stacked on top of each other. Question: Where can i get these books? Candidates: library (0.826), amazon (0.812), comic book store (0.755),  Answer: library Context: a computer monitor sitting on top of a desk. Question: How do i turn this on? Candidates: power button (0.82),  Answer: power button Context: a brown teddy bear sitting on a wooden bench. Question: Who is this toy named after? Candidates: ted (0.879), theodore roosevelt (0.876), roosevelt (0.866), benjamin michtom (0.865), teddy roosevelt (0.862), morris michtom (0.861),  Answer: theodore roosevelt Context: a baseball player sliding into home plate during a game. Question: Is he safe or out? Candidates: safe (0.742), indoor (0.672),  Answer: safe Context: a group of soldiers standing in a room with a cake. Question: What branch of the military is this? Candidates: army (0.826), marine (0.818),  Answer: army Context: a jail cell with a toilet and a sink. Question: Where would i find this room? Candidates: jail (0.859), prison (0.82),  Answer: jail Context: a man doing a trick on a skateboard in the air. Question: What is he jumping off of? Candidates: skateboard (0.811), ramp (0.809), rail (0.808), truck (0.795), wall (0.791), pipe (0.777), platform (0.774), jump (0.774), board (0.772),  Answer: ramp Context: a group of men crossing the street in a city. Question: What should you do before doing this? Candidates: look (0.795), cross (0.733),  Answer: look Context: a bathroom with a toilet and a sink. Question: Who leaves a toilet like this? Candidates: man (0.85), person (0.836), human (0.805), clean (0.791),  Answer:",
"Answer the question according to the context and answer candidates. Each answer candidate is associated with a confidence score within a bracket. The true answer may not be included in the candidates.  Context: a woman talking on a cell phone while sitting at a table with coffee. Question: Who is she talking to? Candidates: friend (0.805), woman (0.727),  Answer: friend Context: a group of people standing in front of a building. Question: Who is this attraction for? Candidates: tourist (0.816), adult (0.748), hotel (0.722),  Answer: tourist Context: a piece of bread sitting on top of a wooden table. Question: Who creates this item? Candidates: baker (0.819),  Answer: baker Context: a group of airplanes parked on an airport runway. Question: Where are the planes? Candidates: airport (0.813),  Answer: at airport Context: a man riding a skateboard on a ramp at a skate park. Question: What is the man on? Candidates: skateboard (0.831), ramp (0.814),  Answer: skateboard Context: a man riding a wave on a paddle board in the ocean. Question: What is the man on? Candidates: surfboard (0.841), paddle board (0.832), board (0.784), paddleboard (0.783),  Answer: surfboard Context: a group of people on skis in the snow. Question: What is the man on? Candidates: ski (0.848), sled (0.842), skier (0.78),  Answer: ski Context: a woman standing on top of a snow covered mountain. Question: What is the person on? Candidates: ski (0.774), skier (0.748),  Answer: ski Context: a purple teddy bear sitting on a bed holding a book. Question: What is the book about? Candidates: mystery (0.75), read (0.725), fiction (0.714),  Answer: mystery Context: a blue train is pulling into a train station. Question: Who owns this train? Candidates: amtrak (0.803), state (0.796), government (0.776), passenger (0.772), russia (0.767), ludwig van decken (0.746), mta (0.743), mrt (0.742),  Answer: amtrak Context: a red and yellow train is on the tracks. Question: What is the train on? Candidates: track (0.824), train (0.785),  Answer: track Context: a subway train pulling into a subway station. Question: What is the train on? Candidates: track (0.814), rail (0.774), train (0.764),  Answer: track Context: a sandwich and pickles on a plate with a knife. Question: What is the filling? Candidates: beef (0.9), meat (0.884), pastrami (0.882),  Answer: beef Context: a pair of purple scissors cutting a pound bill. Question: Who is on this money? Candidates: queen elizabeth (0.778),  Answer: queen elizabeth Context: a person is using a blender with a green liquid. Question: What does the object do? Candidates: blend (0.83),  Answer: blend Context: a table with two candles on it in a room. Question: What are the objects on? Candidates: table (0.845), cross (0.818), candle (0.804),  Answer: table Context: a man sitting at a desk in an office with a computer. Question: What is the man using? Candidates: computer (0.814), worker (0.756),  Answer: computer Context: a man riding skis down a snow covered slope. Question: What is the man using? Candidates: ski (0.834),  Answer: ski Context: a person laying in the snow with a snowboard. Question: What is the person making? Candidates: snow angel (0.826), snowboard (0.793),  Answer: snow angel Context: a group of people sitting in chairs using their laptops. Question: What are the people doing? Candidates: type (0.856), work (0.847), laptop (0.821), study (0.777),  Answer: type Context: a couple of statues sitting on a stone bench. Question: Who designed the statues? Candidates: sculptor (0.849), eiffel (0.84), artist (0.819), bernini (0.787), rossio (0.773),  Answer: "]

for prompt in prompts:
    inputs = tokenizer(prompt, return_tensors="pt")

    # Generate
    generate_ids = model.generate(**inputs, max_new_tokens=10)
    answer = tokenizer.batch_decode(generate_ids, skip_special_tokens=True, clean_up_tokenization_spaces=False)[0]
    print(answer)

    #since this model repeat the whole prompt, only get last answer
    start=[m.start() for m in re.finditer('Answer:', answer)][-1]
    end=[m.start() for m in re.finditer('Context', answer)][-1]
    if end > start:
        print(answer[start+7:end])
        print(answer[start+7:end].strip())
    else:
        print(answer[start+7:])
        print(answer[start+7:].strip())